"use strict";(self["webpackChunkfinalproject"]=self["webpackChunkfinalproject"]||[]).push([[189],{5741:function(e,t,a){var o=a(7972),n=a.n(o);t["Z"]={data(){return{modal:{}}},mounted(){this.modal=new(n())(this.$refs.modal)},methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide()}}}},9227:function(e,t,a){a.d(t,{Z:function(){return f}});var o=a(3396),n=a(9242),s=a(7139);const l={"aria-label":"Page navigation",class:"mt-4"},i={class:"pagination justify-content-center pagination-sm"},d={class:"page-item"},p=(0,o._)("span",{"aria-hidden":"true"},"«",-1),u=[p],c=["onClick"],r={class:"page-item"},h=(0,o._)("span",{"aria-hidden":"true"},"»",-1),m=[h];function _(e,t,a,p,h,_){return(0,o.wg)(),(0,o.iD)("nav",l,[(0,o._)("ul",i,[(0,o._)("li",d,[(0,o._)("a",{class:"page-link",href:"#",onClick:t[0]||(t[0]=(0,n.iM)((e=>_.updatePage(h.currentPage-1)),["prevent"])),"aria-label":"Previous"},u)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.pages.total_pages,(e=>((0,o.wg)(),(0,o.iD)("li",{class:(0,s.C_)(["page-item",{active:e===a.pages.current_page}]),key:e},[(0,o._)("a",{class:"page-link",href:"#",onClick:(0,n.iM)((t=>_.updatePage(e)),["prevent"])},(0,s.zw)(e),9,c)],2)))),128)),(0,o._)("li",r,[(0,o._)("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=(0,n.iM)((e=>_.updatePage(h.currentPage+1)),["prevent"])),"aria-label":"Next"},m)])])])}var b={data(){return{currentPage:1}},props:["pages"],methods:{updatePage(e){e>0&&e<=this.pages.total_pages&&(this.$emit("update-page",e),document.documentElement.scrollTop=0,this.currentPage=e)}}},g=a(89);const C=(0,g.Z)(b,[["render",_]]);var f=C},7189:function(e,t,a){a.r(t),a.d(t,{default:function(){return ce}});var o=a(3396),n=a(9242),s=a(7139);const l={class:"row justify-content-between align-items-center"},i=(0,o._)("h5",{class:"col-3"},"優惠券",-1),d={class:"col d-flex align-items-center"},p={class:"me-3"},u={class:"input-group"},c=["value"],r=(0,o._)("button",{class:"btn btn-secondary input-group-text",type:"submit"},[(0,o._)("i",{class:"bi bi-search"})],-1),h={class:"text-end"},m={class:"bg-light border rounded mt-3 shadow"},_={class:"table mt-4 align-middle"},b=(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",{class:"text-nowrap"},"名稱"),(0,o._)("th",null,"優惠碼"),(0,o._)("th",null,"打折"),(0,o._)("th",{class:"d-none d-md-table-cell"},"到期日"),(0,o._)("th",{class:"text-nowrap"},"是否啟用"),(0,o._)("th",{class:"text-nowrap"},"編輯")])],-1),g={style:{"word-break":"break-all"}},C={class:"d-none d-md-table-cell"},f={class:"form-check form-switch"},v=["onUpdate:modelValue"],w={class:"form-check-label",for:"flexSwitchCheckChecked"},y={class:"btn-group btn-group-sm"},k=["onClick"],x=["onClick"];function M(e,t,a,M,P,D){const $=(0,o.up)("LoadingCom"),U=(0,o.up)("CouponsModal"),L=(0,o.up)("DelCouponsModal"),I=(0,o.up)("PaginationCom");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)($,{active:P.isLoading},null,8,["active"]),(0,o._)("div",l,[i,(0,o._)("div",d,[(0,o._)("form",p,[(0,o._)("div",u,[(0,o._)("input",{class:"form-control form-control-sm",type:"search",placeholder:"請輸入優惠券名稱",value:P.searchInput,onChange:t[0]||(t[0]=e=>P.searchInput=e.target.value),"aria-label":"Search"},null,40,c),r])]),(0,o._)("div",h,[(0,o._)("button",{class:"btn btn-primary text-white text-nowrap",onClick:t[1]||(t[1]=(0,n.iM)((e=>D.openModal(!0)),["prevent"]))},"新增優惠券")])])]),(0,o._)("div",m,[(0,o._)("table",_,[b,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(D.searchData,(t=>((0,o.wg)(),(0,o.iD)("tr",{key:t.id},[(0,o._)("td",null,(0,s.zw)(t.title),1),(0,o._)("td",g,(0,s.zw)(t.code),1),(0,o._)("td",null,(0,s.zw)(t.percent)+"%",1),(0,o._)("td",C,(0,s.zw)(e.$filters.date(t.due_date)),1),(0,o._)("td",null,[(0,o._)("div",f,[(0,o.wy)((0,o._)("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"flexSwitchCheckChecked","onUpdate:modelValue":e=>t.is_enabled=e,"true-value":1,"false-value":0},null,8,v),[[n.e8,t.is_enabled]]),(0,o._)("label",w,(0,s.zw)(t.is_enabled?"啟用":"未啟用"),1)])]),(0,o._)("td",null,[(0,o._)("div",y,[(0,o._)("button",{class:"btn btn-outline-primary p-1 p-md-2",onClick:(0,n.iM)((e=>D.openModal(!1,t)),["prevent"])},"編輯",8,k),(0,o._)("button",{class:"btn btn-outline-danger p-1 p-md-2",onClick:(0,n.iM)((e=>D.delModal(t)),["prevent"])},"刪除",8,x)])])])))),128))])])]),(0,o.Wm)(U,{ref:"couponsModal",coupon:P.tempCoupon,onUpdateCoupon:D.updateCoupon},null,8,["coupon","onUpdateCoupon"]),(0,o.Wm)(L,{ref:"delCouponsModal",item:P.tempCoupon,onDelItem:D.delCoupon},null,8,["item","onDelItem"]),P.searchInput?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(I,{key:0,pages:P.pagination,onUpdatePage:D.getCoupons},null,8,["pages","onUpdatePage"]))],64)}const P={class:"modal",tabindex:"-1",ref:"modal"},D={class:"modal-dialog modal-xl",role:"document"},$={class:"modal-content border-0"},U=(0,o._)("div",{class:"modal-header bg-primary text-white"},[(0,o._)("h4",{class:"modal-title",id:"exampleModalLabel"},"優惠券"),(0,o._)("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),L={class:"modal-body"},I={class:"mb-3"},Z=(0,o._)("label",{for:"title"},"標題",-1),S={class:"mb-3"},z=(0,o._)("label",{for:"coupon_code"},"優惠碼",-1),V={class:"mb-3"},j=(0,o._)("label",{for:"percent",class:"form-label"},"打折",-1),N={class:"mb-3"},H=(0,o._)("label",{for:"due_date"},"到期日",-1),W={class:"mb-3"},Y={class:"form-check"},A=(0,o._)("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),E={class:"modal-footer"},K=(0,o._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1);function T(e,t,a,s,l,i){return(0,o.wg)(),(0,o.iD)("div",P,[(0,o._)("div",D,[(0,o._)("div",$,[U,(0,o._)("div",L,[(0,o._)("div",I,[Z,(0,o.wy)((0,o._)("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=e=>l.tempCoupon.title=e),placeholder:"請輸入標題"},null,512),[[n.nr,l.tempCoupon.title]])]),(0,o._)("div",S,[z,(0,o.wy)((0,o._)("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[1]||(t[1]=e=>l.tempCoupon.code=e),placeholder:"請輸入優惠碼"},null,512),[[n.nr,l.tempCoupon.code]])]),(0,o._)("div",V,[j,(0,o.wy)((0,o._)("input",{type:"number",class:"form-control",id:"percent",placeholder:"請輸入折扣百分比","onUpdate:modelValue":t[2]||(t[2]=e=>l.tempCoupon.percent=e)},null,512),[[n.nr,l.tempCoupon.percent,void 0,{number:!0}]])]),(0,o._)("div",N,[H,(0,o.wy)((0,o._)("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[3]||(t[3]=e=>l.due_date=e)},null,512),[[n.nr,l.due_date]])]),(0,o._)("div",W,[(0,o._)("div",Y,[(0,o.wy)((0,o._)("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":t[4]||(t[4]=e=>l.tempCoupon.is_enabled=e)},null,512),[[n.e8,l.tempCoupon.is_enabled]]),A])])]),(0,o._)("div",E,[K,(0,o._)("button",{type:"button",class:"btn btn-outline-primary",onClick:t[5]||(t[5]=t=>e.$emit("update-coupon",l.tempCoupon))},"確認")])])])],512)}var q=a(5741),O={data(){return{tempCoupon:{percent:100},due_date:""}},props:{coupon:{}},watch:{coupon(){if(this.tempCoupon=this.coupon,this.tempCoupon.due_date){const e=new Date(1e3*this.tempCoupon.due_date).toISOString().split("T");[this.due_date]=e}},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},emits:["update-coupon"],mixins:[q.Z]},R=a(89);const B=(0,R.Z)(O,[["render",T]]);var F=B,G=a(9227);const J={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},Q={class:"modal-dialog"},X={class:"modal-content"},ee=(0,o._)("div",{class:"modal-header bg-primary text-white"},[(0,o._)("h5",{class:"modal-title",id:"exampleModalLabel"},"刪除產品"),(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),te={class:"modal-body"},ae={class:"text-danger"},oe={class:"modal-footer"},ne=(0,o._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function se(e,t,a,n,l,i){return(0,o.wg)(),(0,o.iD)("div",J,[(0,o._)("div",Q,[(0,o._)("div",X,[ee,(0,o._)("div",te,[(0,o.Uk)(" 請確認是否刪除優惠券 "),(0,o._)("span",ae,(0,s.zw)(a.item.title),1),(0,o.Uk)("，刪除後將無法復原。 ")]),(0,o._)("div",oe,[ne,(0,o._)("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=t=>e.$emit("del-item",a.item))},"確認")])])])],512)}var le={props:{item:{}},emits:["del-item"],mixins:[q.Z]};const ie=(0,R.Z)(le,[["render",se]]);var de=ie,pe={data(){return{coupons:[],pagination:{},tempCoupon:{},isNew:!1,isLoading:!1,searchInput:""}},created(){this.getCoupons(),this.searchInput=""},methods:{getCoupons(e=1){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/alisonhu-api/admin/coupons?page=${e}`;this.axios.get(t).then((e=>{this.isLoading=!1,this.coupons=e.data.coupons,this.pagination=e.data.pagination;const t=e.data.pagination.total_pages;if(e.data.pagination.has_next)for(let a=2;a<=t;a++)this.getAllCoupons(a)}))},getAllCoupons(e){const t=`https://vue3-course-api.hexschool.io/api/alisonhu-api/admin/coupons?page=${e}`;this.axios.get(t).then((e=>{this.coupons=this.coupons.concat(e.data.coupons)}))},openModal(e,t){e?(this.tempCoupon={},this.$refs.couponsModal.due_date=""):this.tempCoupon={...t},this.isNew=e,this.$refs.couponsModal.showModal()},updateCoupon(e){this.isLoading=!0,this.tempCoupon=e;let t="https://vue3-course-api.hexschool.io/api/alisonhu-api/admin/coupon",a="post";this.isNew||(t=`https://vue3-course-api.hexschool.io/api/alisonhu-api/admin/coupon/${e.id}`,a="put"),this.axios[a](t,{data:this.tempCoupon}).then((e=>{this.isLoading=!1,this.$refs.couponsModal.hideModal(),this.getCoupons(this.pagination.current_page),this.PushMessageState(e,"更新")}))},delModal(e){this.tempCoupon={...e},this.$refs.delCouponsModal.showModal()},delCoupon(e){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/alisonhu-api/admin/coupon/${e.id}`;this.axios.delete(t).then((e=>{this.isLoading=!1,this.$refs.delCouponsModal.hideModal(),this.getCoupons(this.pagination.current_page),this.PushMessageState(e,"刪除")}))}},computed:{searchData(){const e=new RegExp(this.searchInput,"gi");return this.coupons.filter((t=>t.title.match(e)))}},components:{CouponsModal:F,DelCouponsModal:de,PaginationCom:G.Z},inject:["emitter","PushMessageState"]};const ue=(0,R.Z)(pe,[["render",M]]);var ce=ue}}]);
//# sourceMappingURL=189.d99cea27.js.map