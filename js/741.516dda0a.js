"use strict";(self["webpackChunkfinalproject"]=self["webpackChunkfinalproject"]||[]).push([[741],{5741:function(t,e,a){var l=a(7972),s=a.n(l);e["Z"]={data(){return{modal:{}}},mounted(){this.modal=new(s())(this.$refs.modal)},methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide()}}}},9227:function(t,e,a){a.d(e,{Z:function(){return w}});var l=a(3396),s=a(9242),r=a(7139);const d={"aria-label":"Page navigation",class:"mt-4"},o={class:"pagination justify-content-center pagination-sm"},i={class:"page-item"},n=(0,l._)("span",{"aria-hidden":"true"},"«",-1),c=[n],p=["onClick"],u={class:"page-item"},m=(0,l._)("span",{"aria-hidden":"true"},"»",-1),h=[m];function _(t,e,a,n,m,_){return(0,l.wg)(),(0,l.iD)("nav",d,[(0,l._)("ul",o,[(0,l._)("li",i,[(0,l._)("a",{class:"page-link",href:"#",onClick:e[0]||(e[0]=(0,s.iM)((t=>_.updatePage(m.currentPage-1)),["prevent"])),"aria-label":"Previous"},c)]),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.pages.total_pages,(t=>((0,l.wg)(),(0,l.iD)("li",{class:(0,r.C_)(["page-item",{active:t===a.pages.current_page}]),key:t},[(0,l._)("a",{class:"page-link",href:"#",onClick:(0,s.iM)((e=>_.updatePage(t)),["prevent"])},(0,r.zw)(t),9,p)],2)))),128)),(0,l._)("li",u,[(0,l._)("a",{class:"page-link",href:"#",onClick:e[1]||(e[1]=(0,s.iM)((t=>_.updatePage(m.currentPage+1)),["prevent"])),"aria-label":"Next"},h)])])])}var g={data(){return{currentPage:1}},props:["pages"],methods:{updatePage(t){t>0&&t<=this.pages.total_pages&&(this.$emit("update-page",t),document.documentElement.scrollTop=0,this.currentPage=t)}}},b=a(89);const f=(0,b.Z)(g,[["render",_]]);var w=f},3741:function(t,e,a){a.r(e),a.d(e,{default:function(){return Nt}});var l=a(3396),s=a(7139),r=a(9242);const d={class:"d-flex justify-content-between align-items-center"},o=(0,l._)("h5",null,"訂單",-1),i={class:"me-3"},n={class:"input-group"},c=["value"],p=(0,l._)("button",{class:"btn btn-secondary input-group-text",type:"submit"},[(0,l._)("i",{class:"bi bi-search"})],-1),u={class:"bg-light border rounded mt-3 shadow"},m={class:"table table-sm mt-3 align-middle"},h=(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th",null,"訂單編號"),(0,l._)("th",{class:"d-none d-md-table-cell"},"購買時間"),(0,l._)("th",null,"購買人"),(0,l._)("th",null,[(0,l._)("div",null,"購買品項")]),(0,l._)("th",{class:"text-nowrap"},"應付金額"),(0,l._)("th",{class:"text-nowrap d-none d-md-table-cell"},"是否付款"),(0,l._)("th",null,"編輯")])],-1),_={class:"d-none d-md-table-cell"},g={class:"text-nowrap"},b={class:"d-none d-md-table-cell"},f={class:"form-check form-switch"},w=["onUpdate:modelValue"],y={class:"form-check-label",for:"flexSwitchCheckChecked"},v={class:"btn-group btn-group-sm"},O=["onClick"],P=["onClick"];function k(t,e,a,k,x,M){const C=(0,l.up)("LoadingCom"),D=(0,l.up)("PaginationCom"),q=(0,l.up)("OrdersModal"),U=(0,l.up)("DelOrdersModal");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(C,{active:x.isLoading},null,8,["active"]),(0,l._)("div",d,[o,(0,l._)("form",i,[(0,l._)("div",n,[(0,l._)("input",{class:"form-control form-control-sm",type:"search",placeholder:"請輸入訂單編號",value:x.searchInput,onChange:e[0]||(e[0]=t=>x.searchInput=t.target.value),"aria-label":"Search"},null,40,c),p])])]),(0,l._)("div",u,[(0,l._)("table",m,[h,(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(M.searchData,(e=>((0,l.wg)(),(0,l.iD)("tr",{key:e.id,class:"fs-7"},[(0,l._)("td",null,(0,s.zw)(e.id.substring(1,8)),1),(0,l._)("td",_,(0,s.zw)(t.$filters.date(e.create_at)),1),(0,l._)("td",null,(0,s.zw)(e.user.name),1),(0,l._)("td",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.products,(t=>((0,l.wg)(),(0,l.iD)("div",{key:t.id},(0,s.zw)(t.product.title)+" x "+(0,s.zw)(t.qty),1)))),128))]),(0,l._)("td",g,(0,s.zw)(t.$filters.currency(e.total)),1),(0,l._)("td",b,[(0,l._)("div",f,[(0,l.wy)((0,l._)("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"flexSwitchCheckChecked","onUpdate:modelValue":t=>e.is_paid=t},null,8,w),[[r.e8,e.is_paid]]),(0,l._)("label",y,(0,s.zw)(e.is_paid?"已付款":"未付款"),1)])]),(0,l._)("td",null,[(0,l._)("div",v,[(0,l._)("button",{class:"btn btn-outline-primary p-1 p-md-2",type:"button",onClick:t=>M.openModal(e)},"編輯",8,O),(0,l._)("button",{class:"btn btn-outline-danger p-1 p-md-2",type:"button",onClick:t=>M.delOrdersModal(e)},"刪除",8,P)])])])))),128))])])]),x.searchInput?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(D,{key:0,pages:x.pagination,onUpdatePage:M.getOrders},null,8,["pages","onUpdatePage"])),(0,l.Wm)(q,{ref:"ordersModal",order:x.tempOrder,onUpdateOrder:M.updateOrder},null,8,["order","onUpdateOrder"]),(0,l.Wm)(U,{ref:"delOrdersModal",item:x.tempOrder,onDelItem:M.delOrders},null,8,["item","onDelItem"])],64)}var x=a(9227);const M={class:"modal",tabindex:"-1",ref:"modal"},C={class:"modal-dialog modal-xl"},D={class:"modal-content border-0"},q=(0,l._)("div",{class:"modal-header bg-primary text-white"},[(0,l._)("h4",{class:"modal-title"},"訂單"),(0,l._)("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),U={class:"modal-body"},$={class:"row g-3"},z=(0,l._)("h5",{class:"fw-bold"},"訂單細節",-1),I={class:"col-sm-6"},V=(0,l._)("label",{for:"orderId",class:"form-label"},"訂單編號",-1),L={class:"col-sm-4"},S=(0,l._)("label",{for:"orderMsg",class:"form-label"},"備註",-1),Z={class:"col-sm-2"},j={class:"form-check pt-4"},H=(0,l._)("label",{class:"form-check-label",for:"is_paid"},"是否付款",-1),K={class:"col-sm-6"},Y=(0,l._)("label",{for:"create_at",class:"form-label"},"下單時間",-1),E={class:"col-sm-6"},A=(0,l._)("label",{for:"paid_date",class:"form-label"},"付款時間",-1),T=(0,l._)("h5",{class:"fw-bold mt-5"},"用戶資料",-1),W={class:"col-sm-6"},N=(0,l._)("label",{for:"name",class:"form-label"},"姓名",-1),R={class:"col-sm-6"},B=(0,l._)("label",{for:"email",class:"form-label"},"Email",-1),F={class:"col-sm-6"},G=(0,l._)("label",{for:"tel",class:"form-label"},"電話",-1),J={class:"col-sm-6"},Q=(0,l._)("label",{for:"address",class:"form-label"},"地址",-1),X=(0,l._)("h5",{class:"fw-bold mt-5"},"選購商品",-1),tt={class:"table align-middle"},et={class:"pb-5"},at={class:"pb-5"},lt=(0,l._)("label",{for:"product_title",class:"form-label"},"商品名稱",-1),st=(0,l._)("option",{disabled:"",value:""},"請選擇商品",-1),rt={key:0,class:"text-danger d-block"},dt={class:"pb-5"},ot=(0,l._)("label",{for:"qty",class:"form-label"},"商品數量",-1),it={class:"pb-5"},nt={key:0},ct=(0,l._)("p",null,"商品小計",-1),pt={class:"mt-1 text-end pe-2"},ut={class:"col-sm-2"},mt=["onClick"],ht=(0,l._)("i",{class:"bi bi-x-lg fw-bold"},null,-1),_t=[ht],gt={key:0,class:"text-nowrap"},bt={class:"text-end text-nowrap"},ft={colspan:"4",class:"text-end fw-bold"},wt={key:0},yt=(0,l._)("span",null,"折扣",-1),vt={class:"ps-4"},Ot=(0,l._)("span",null,"總金額",-1),Pt={class:"ps-4"},kt={class:"modal-footer"},xt=(0,l._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1);function Mt(t,e,a,d,o,i){return(0,l.wg)(),(0,l.iD)("div",M,[(0,l._)("div",C,[(0,l._)("div",D,[q,(0,l._)("div",U,[(0,l._)("form",$,[z,(0,l._)("div",I,[V,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.tempOrder.id=t),placeholder:"請輸入訂單編號",type:"text",class:"form-control",id:"orderId"},null,512),[[r.nr,o.tempOrder.id]])]),(0,l._)("div",L,[S,(0,l.wy)((0,l._)("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.tempOrder.message=t),class:"form-control",id:"orderMsg"},null,512),[[r.nr,o.tempOrder.message]])]),(0,l._)("div",Z,[(0,l._)("div",j,[(0,l.wy)((0,l._)("input",{class:"form-check-input",type:"checkbox","true-value":!0,"false-value":!1,id:"is_paid","onUpdate:modelValue":e[2]||(e[2]=t=>o.tempOrder.is_paid=t)},null,512),[[r.e8,o.tempOrder.is_paid]]),H])]),(0,l._)("div",K,[Y,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.create_at=t),placeholder:"請輸入下單時間",type:"date",class:"form-control",id:"create_at"},null,512),[[r.nr,o.create_at]])]),(0,l._)("div",E,[A,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.paid_date=t),placeholder:"請輸入付款時間",type:"date",class:"form-control",id:"paid_date"},null,512),[[r.nr,o.paid_date]])]),T,(0,l._)("div",W,[N,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.tempOrder.user.name=t),placeholder:"請輸入姓名",type:"text",class:"form-control",id:"name"},null,512),[[r.nr,o.tempOrder.user.name]])]),(0,l._)("div",R,[B,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.tempOrder.user.email=t),placeholder:"請輸入Email",type:"email",class:"form-control",id:"email"},null,512),[[r.nr,o.tempOrder.user.email]])]),(0,l._)("div",F,[G,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.tempOrder.user.tel=t),placeholder:"請輸入電話",type:"text",class:"form-control",id:"tel"},null,512),[[r.nr,o.tempOrder.user.tel]])]),(0,l._)("div",J,[Q,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>o.tempOrder.user.address=t),placeholder:"請輸入地址",type:"address",class:"form-control",id:"address"},null,512),[[r.nr,o.tempOrder.user.address]])]),X,(0,l._)("table",tt,[(0,l._)("tbody",null,[(0,l._)("tr",null,[(0,l._)("td",et,[(0,l._)("div",null,[(0,l._)("button",{type:"button",class:"btn btn-success btn-sm",onClick:e[9]||(e[9]=(0,r.iM)(((...t)=>i.addProduct&&i.addProduct(...t)),["prevent"]))},"新增")])]),(0,l._)("td",at,[lt,(0,l.wy)((0,l._)("select",{"onUpdate:modelValue":e[10]||(e[10]=t=>o.tempProduct.product.title=t),id:"product_title",onChange:e[11]||(e[11]=(...t)=>i.updatePrice&&i.updatePrice(...t)),class:"form-select"},[st,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.allProducts,(t=>((0,l.wg)(),(0,l.iD)("option",{key:t.id},(0,s.zw)(t.title),1)))),128))],544),[[r.bM,o.tempProduct.product.title]]),o.wrongMsg?((0,l.wg)(),(0,l.iD)("small",rt,(0,s.zw)(o.wrongMsg),1)):(0,l.kq)("",!0)]),(0,l._)("td",dt,[ot,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>o.tempProduct.qty=t),placeholder:"請輸入商品數量",onChange:e[13]||(e[13]=(...t)=>i.updatePrice&&i.updatePrice(...t)),type:"number",min:"1",class:"form-control",id:"qty"},null,544),[[r.nr,o.tempProduct.qty,void 0,{number:!0}]])]),(0,l._)("td",it,[o.tempProduct.product.title&&o.tempProduct.qty?((0,l.wg)(),(0,l.iD)("div",nt,[ct,(0,l._)("p",pt,(0,s.zw)(t.$filters.currency(o.tempProduct.total)),1)])):(0,l.kq)("",!0)])]),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.tempOrder.products,((e,a)=>((0,l.wg)(),(0,l.iD)("tr",{key:e.id},[(0,l._)("td",null,[(0,l._)("div",ut,[(0,l._)("button",{type:"button",class:"btn btn-danger btn-sm",onClick:(0,r.iM)((t=>i.delProduct(a)),["prevent"])},_t,8,mt)])]),e.product?((0,l.wg)(),(0,l.iD)("td",gt,(0,s.zw)(e.product.title),1)):(0,l.kq)("",!0),(0,l._)("td",null,"x "+(0,s.zw)(e.qty),1),(0,l._)("td",bt,(0,s.zw)(t.$filters.currency(e.total)),1)])))),128))]),(0,l._)("tr",null,[(0,l._)("td",ft,[0!==i.discount?((0,l.wg)(),(0,l.iD)("div",wt,[yt,(0,l._)("span",vt,"- "+(0,s.zw)(t.$filters.currency(i.discount)),1)])):(0,l.kq)("",!0),(0,l._)("div",null,[Ot,(0,l._)("span",Pt,(0,s.zw)(t.$filters.currency(o.tempOrder.total)),1)])])])])]),(0,l._)("div",kt,[xt,(0,l._)("button",{type:"button",class:"btn btn-outline-primary",onClick:e[14]||(e[14]=e=>t.$emit("update-order",o.tempOrder))},"確認")])])])])],512)}var Ct=a(5741),Dt={data(){return{tempOrder:{user:{},id:"",products:{},total:0},create_at:"",paid_date:"",tempProductId:"",tempProduct:{product:{title:"",price:0},qty:1,total:0,final_total:0},allProducts:[],wrongMsg:""}},created(){this.getAllProducts()},props:{order:{}},methods:{getAllProducts(){const t="https://vue3-course-api.hexschool.io/api/alisonhu-api/admin/products/all";this.axios.get(t).then((t=>{this.allProducts=Object.values(t.data.products)}))},updatePrice(){const t=this.allProducts.filter((t=>t.title===this.tempProduct.product.title));this.tempProduct.product=t[0],this.tempProduct.total=this.tempProduct.product.price*this.tempProduct.qty,this.tempProduct.final_total=this.tempProduct.total},addProduct(){if(this.tempProduct.product.title&&this.tempProduct.qty){const t=Math.floor(1e4*Math.random());this.tempProductId=`-NMdbK3PnewOrder${t}`,this.tempOrder.products[this.tempProductId]=this.tempProduct,this.tempOrder.total+=this.tempProduct.product.price*this.tempProduct.qty,this.tempProduct={product:{title:""},qty:1},this.wrongMsg=""}else!this.tempProduct.product.title&&this.tempProduct.qty?this.wrongMsg="新增失敗，請選擇商品名稱":this.tempProduct.product.title&&!this.tempProduct.qty?this.wrongMsg="新增失敗，請選擇商品數量":this.wrongMsg="新增失敗，請選擇商品名稱及數量"},delProduct(t){this.tempOrder.total-=this.tempOrder.products[t].final_total,delete this.tempOrder.products[t]}},computed:{discount(){let t=0;const e=Object.values(this.tempOrder.products);return e.forEach((e=>{t+=e.total-e.final_total})),t}},watch:{order(){if(this.tempOrder=this.order,this.tempOrder.create_at){const t=new Date(1e3*this.tempOrder.create_at).toISOString().split("T");[this.create_at]=t}if(this.tempOrder.paid_date){const t=new Date(1e3*this.tempOrder.paid_date).toISOString().split("T");[this.paid_date]=t}},create_at(){this.tempOrder.create_at=Math.floor(new Date(this.create_at)/1e3)},paid_date(){this.tempOrder.paid_date=Math.floor(new Date(this.paid_date)/1e3)}},emits:["update-order"],mixins:[Ct.Z]},qt=a(89);const Ut=(0,qt.Z)(Dt,[["render",Mt]]);var $t=Ut;const zt={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},It={class:"modal-dialog"},Vt={class:"modal-content"},Lt=(0,l._)("div",{class:"modal-header bg-primary text-white"},[(0,l._)("h5",{class:"modal-title",id:"exampleModalLabel"},"刪除訂單"),(0,l._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),St={class:"modal-body"},Zt={class:"text-danger"},jt={class:"modal-footer"},Ht=(0,l._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function Kt(t,e,a,r,d,o){return(0,l.wg)(),(0,l.iD)("div",zt,[(0,l._)("div",It,[(0,l._)("div",Vt,[Lt,(0,l._)("div",St,[(0,l.Uk)(" 請確認是否刪除訂單編號 "),(0,l._)("span",Zt,(0,s.zw)(a.item.id),1),(0,l.Uk)("，刪除後將無法復原。 ")]),(0,l._)("div",jt,[Ht,(0,l._)("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=e=>t.$emit("del-item",a.item))},"確認")])])])],512)}var Yt={props:{item:{}},emits:["del-item"],mixins:[Ct.Z]};const Et=(0,qt.Z)(Yt,[["render",Kt]]);var At=Et,Tt={data(){return{orders:[],pagination:{total_pages:""},tempOrder:{},isLoading:!1,searchInput:""}},created(){this.getOrders(),this.searchInput=""},methods:{getOrders(t=1){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/alisonhu-api/admin/orders?page=${t}`;this.axios.get(e).then((t=>{this.isLoading=!1,this.orders=t.data.orders,this.pagination=t.data.pagination;const e=t.data.pagination.total_pages;if(t.data.pagination.has_next)for(let a=2;a<=e;a++)this.getAllOrders(a)}))},getAllOrders(t){const e=`https://vue3-course-api.hexschool.io/api/alisonhu-api/admin/orders?page=${t}`;this.axios.get(e).then((t=>{this.orders=this.orders.concat(t.data.orders)}))},openModal(t){this.tempOrder={...t},this.$refs.ordersModal.showModal()},delOrdersModal(t){this.tempOrder={...t},this.$refs.delOrdersModal.showModal()},delOrders(t){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/alisonhu-api/admin/order/${t.id}`;this.axios.delete(e).then((t=>{this.isLoading=!1,this.$refs.delOrdersModal.hideModal(),this.getOrders(this.pagination.current_page),this.PushMessageState(t,"刪除")}))},updateOrder(t){this.isLoading=!0,this.tempOrder=t;const e=`https://vue3-course-api.hexschool.io/api/alisonhu-api/admin/order/${t.id}`;this.axios.put(e,{data:this.tempOrder}).then((t=>{this.isLoading=!1,this.$refs.ordersModal.hideModal(),this.getOrders(this.pagination.current_page),this.PushMessageState(t,"更新")}))}},computed:{searchData(){const t=new RegExp(this.searchInput,"gi");return this.orders.filter((e=>e.id.match(t)))}},components:{PaginationCom:x.Z,OrdersModal:$t,DelOrdersModal:At},inject:["emitter","PushMessageState"]};const Wt=(0,qt.Z)(Tt,[["render",k]]);var Nt=Wt}}]);
//# sourceMappingURL=741.516dda0a.js.map